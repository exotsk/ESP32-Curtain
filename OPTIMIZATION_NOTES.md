# –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –®—Ç–æ—Ä ESP32 - –°–≤–æ–¥–∫–∞ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## –û–±–∑–æ—Ä
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∫ –ø—Ä–æ–µ–∫—Ç—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —à—Ç–æ—Ä ESP32.

---

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –û—à–∏–±–∫–∏

### 1. **–û—à–∏–±–∫–∞ –≤ –ò–º–µ–Ω–∏ –ü–µ—Ä–µ–º–µ–Ω–Ω–æ–π (–°—Ç—Ä–æ–∫–∞ 141)**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `checkStep1()` –ø—Ä–æ–≤–µ—Ä—è–ª `steps_from_zero2` –≤–º–µ—Å—Ç–æ `steps_from_zero1`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–æ–≥–∏–∫–∞ –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–∞ –î–≤–∏–≥–∞—Ç–µ–ª—è 1 —á–∏—Ç–∞–ª–∞ –ø–æ–∑–∏—Ü–∏—é –î–≤–∏–≥–∞—Ç–µ–ª—è 2
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `processStepperController()` –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MQTT**
- **–î–æ**: –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ü–∏–∫–ª `while` —Å 6-—Å–µ–∫—É–Ω–¥–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- **–ü–æ—Å–ª–µ**: –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤–æ–π –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

### 2. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ó–∞–¥–µ—Ä–∂–∫–∏**
- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 5 —Å–µ–∫—É–Ω–¥, —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–±–æ–µ, –º–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥
- –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ç—å –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–±–æ–µ–≤
- –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3. **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ù–µ–Ω—É–∂–Ω—ã–µ –ó–∞–¥–µ—Ä–∂–∫–∏**
- –£–¥–∞–ª–µ–Ω–∞ `delay(1000)` –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –î–æ–±–∞–≤–ª–µ–Ω `yield()` –¥–ª—è –ª—É—á—à–µ–π –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏
- –£–ª—É—á—à–µ–Ω–∞ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å —à–∞–≥–æ–≤—ã—Ö –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π

### 4. **–¢–∞–π–º–∞—É—Ç –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è WiFi**
- –î–æ–±–∞–≤–ª–µ–Ω 20-—Å–µ–∫—É–Ω–¥–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å–±–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –°–±—Ä–æ—Å —Å—Ç–æ—Ä–æ–∂–µ–≤–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –≤–æ –≤—Ä–µ–º—è –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## üîß –£–ª—É—á—à–µ–Ω–∏—è –ö–∞—á–µ—Å—Ç–≤–∞ –ö–æ–¥–∞

### 1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ö–æ–¥–∞**
- **–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ**: `checkStep1()` –∏ `checkStep2()` (140 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞)
- **–°–æ–∑–¥–∞–Ω–æ**: –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `processStepperController()`
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**: 
  - –ë–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
  - –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
  - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö**
```cpp
struct StepperController {
  AccelStepper* stepper;
  int32_t targetPosition;
  int32_t lastPublishedPosition;
  bool hysteresisActive;
  int upperLimitPin;
  int lowerLimitPin;
  const char* positionTopic;
};
```
- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π
- –£–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

### 3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π**
- –°–æ–∑–¥–∞–Ω `config.h` –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π: –∫–æ–¥ vs –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –õ—É—á—à–µ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç (–æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ, —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–µ–µ—Å—è)

### 4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –ö–æ–¥–∞**
- –ó–∞–º–µ–Ω–∞ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –õ—É—á—à–∏–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

---

## üõ°Ô∏è –£–ª—É—á—à–µ–Ω–∏—è –ù–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

### 1. **–°—Ç–æ—Ä–æ–∂–µ–≤–æ–π –¢–∞–π–º–µ—Ä**
```cpp
esp_task_wdt_init(WATCHDOG_TIMEOUT_S, true);
esp_task_wdt_add(NULL);
```
- –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã (—Ç–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
- –£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –±–µ–∑–æ—Ç–∫–∞–∑–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### 2. **–ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ WiFi**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WiFi –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ç–∏—Ö—É—é –ø–æ—Ç–µ—Ä—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –í–≤–æ–¥–∞**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É MQTT payload
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ–∑–∏—Ü–∏–∏ (0 –¥–æ CURTAIN_MAXIMUM)
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–µ—Ä–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫ –∏ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```cpp
Serial.println("Error: Position out of range");
Serial.println("WiFi disconnected! Reconnecting...");
```
- –ü–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ –æ—Ç–ª–∞–¥–∫–∏
- –û—Ç—á—ë—Ç –æ —Å—Ç–∞—Ç—É—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –æ—à–∏–±–æ–∫
- –ë–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

---

## üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ü–∞–º—è—Ç–∏

### 1. **–ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ –°—Ç—Ä–æ–∫–∏**
- –ó–∞–º–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤ `String` –Ω–∞ `const char*`
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫—É—á–∏
- –ú–µ–Ω—å—à–∏–π –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏

### 2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**
- –£–¥–∞–ª–µ–Ω–æ: `got_int1`, `got_int2`, `got_float`, `p_payload`, `i`
- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ
- –°–Ω–∏–∂–µ–Ω–æ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º—ë–Ω

### 3. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë—É—Ñ–µ—Ä–∞**
- –ï–¥–∏–Ω—ã–π `msgBuffer` –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –°–Ω–∏–∂–µ–Ω—ã –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

---

## üîê –£–ª—É—á—à–µ–Ω–∏—è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ MQTT**
```cpp
if (strlen(MQTT_USER) > 0) {
  connected = client.connect(clientId.c_str(), MQTT_USER, MQTT_PASS);
}
```
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–ø–∞—Ä–æ–ª—å
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∞–Ω–æ–Ω–∏–º–Ω—ã–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏

### 2. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID –ö–ª–∏–µ–Ω—Ç–æ–≤**
```cpp
String clientId = String(MQTT_CLIENT_ID) + "-" + String(random(0xffff), HEX);
```
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã ID –∫–ª–∏–µ–Ω—Ç–æ–≤
- –õ—É—á—à–µ –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### 3. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–æ–º —Ñ–∞–π–ª–µ
- –ü—Ä–æ—â–µ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìà –£–ª—É—á—à–µ–Ω–∏—è –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ –û—Å–Ω–æ–≤–µ –ú–∞—Å—Å–∏–≤–æ–≤**
```cpp
StepperController controllers[2] = { ... };
```
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π (–ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –º–∞—Å—Å–∏–≤)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–∏–∫–ª–æ–≤
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π

### 2. **–ú–∞—Å—Å–∏–≤—ã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ü–∏–Ω–æ–≤**
```cpp
const int STEPPER1_PINS[4] = {32, 25, 33, 26};
```
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∏–Ω–æ–≤
- –ë–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- –°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–µ–µ—Å—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∏–Ω–æ–≤

---

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### 1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –û—Ç–ª–∞–¥–∫–∞**
- –í—ã–≤–æ–¥ Serial –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 115200 baud
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- –û—Ç—á—ë—Ç—ã –æ–± —É—Å–ª–æ–≤–∏—è—Ö –æ—à–∏–±–æ–∫

### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –û–±—Ä–∞—Ç–Ω–∞—è –°–≤—è–∑—å MQTT**
```cpp
if (client.subscribe(MQTT_STEP1)) {
  Serial.println("Subscribed to topic");
}
```
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
- –°–æ–æ–±—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ü–æ–∑–∏—Ü–∏–∏**
- –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

## üìù –£–ª—É—á—à–µ–Ω–∏—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 1. **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**
- –û–±—ä—è—Å–Ω—è–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### 2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ü–∏–Ω–æ–≤**
```cpp
const int SWITCH_1_PIN = 17;  // –î–≤–∏–≥–∞—Ç–µ–ª—å 1 - –í–µ—Ä—Ö–Ω–∏–π –∫–æ–Ω—Ü–µ–≤–∏–∫
```
- –ö–∞–∂–¥—ã–π –ø–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

### 3. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- –ß—ë—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ vs –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –û–±—ä—è—Å–Ω–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤—É–º—è —à–∞–≥–æ–≤—ã–º–∏ –¥–≤–∏–≥–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥ MQTT
- ‚úÖ –û—Ç—á—ë—Ç –æ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ü–µ–≤—ã—Ö –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–µ–π
- ‚úÖ –õ–æ–≥–∏–∫–∞ –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–∞
- ‚úÖ –¢–∞ –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–ø–∏–∫–æ–≤ MQTT
- ‚úÖ –¢–æ—Ç –∂–µ –º–∞—Å—à—Ç–∞–± –ø–æ–∑–∏—Ü–∏–∏ (√ó100)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ò–∑–º–µ–Ω–µ–Ω–∏—è
- ‚ö†Ô∏è –û—Ç–ª–∞–¥–∫–∞ —á–µ—Ä–µ–∑ Serial —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (115200 baud)
- ‚ö†Ô∏è –°—Ç–æ—Ä–æ–∂–µ–≤–æ–π —Ç–∞–π–º–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ —Å–±—Ä–æ—Å–∞ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚ö†Ô∏è –î—Ä—É–≥–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ vs —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ 6—Å)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –°—Ç—Ä–æ–∫ –ö–æ–¥–∞ | 232 | 294 | +27% (—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏/—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π) |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ö–æ–¥–∞ | 140 —Å—Ç—Ä–æ–∫ | 0 —Å—Ç—Ä–æ–∫ | -100% |
| –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | 12 | 4 | -67% |
| –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MQTT | –ë–ª–æ–∫–∏—Ä—É—é—â–µ–µ | –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ | ‚àû% |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ì–ª–∞–≤–Ω–æ–≥–æ –¶–∏–∫–ª–∞ | 1000–º—Å | 0–º—Å | -100% |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫ | –ù–µ—Ç | –ü–æ–ª–Ω–∞—è | ‚àû% |
| –í—ã–≤–æ–¥ –û—Ç–ª–∞–¥–∫–∏ | –ù–µ—Ç | –ü–æ–ª–Ω—ã–π | ‚àû% |

---

## üö¶ –ù–∞—á–∞–ª–æ –†–∞–±–æ—Ç—ã

### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `include/config.h` –∏–ª–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `CurtainsESP32.ino`:
```cpp
#define WIFI_SSID "–ò–º—è–í–∞—à–µ–π–°–µ—Ç–∏"
#define WIFI_PASSWORD "–í–∞—à–ü–∞—Ä–æ–ª—å"
#define MQTT_SERVER "192.168.1.100"
```

### 2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ü—Ä–æ—à–∏–≤–∫—É
```bash
platformio run --target upload
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –í—ã–≤–æ–¥–∞ Serial
```bash
platformio device monitor
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MQTT –ö–æ–º–∞–Ω–¥
```bash
# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —à—Ç–æ—Ä—É 1 –≤ –ø–æ–∑–∏—Ü–∏—é 250 (25000 —à–∞–≥–æ–≤)
mosquitto_pub -h –í–ê–®_MQTT_–°–ï–†–í–ï–† -t /CURTAINS/ROLL1/ -m "250"

# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —à—Ç–æ—Ä—É 2 –≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç–æ–µ (0)
mosquitto_pub -h –í–ê–®_MQTT_–°–ï–†–í–ï–† -t /CURTAINS/ROLL2/ -m "0"

# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —à—Ç–æ—Ä—É 1 –≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç–æ–µ (550)
mosquitto_pub -h –í–ê–®_MQTT_–°–ï–†–í–ï–† -t /CURTAINS/ROLL1/ -m "550"
```

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ü–æ–∑–∏—Ü–∏–∏
```bash
# –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
mosquitto_sub -h –í–ê–®_MQTT_–°–ï–†–í–ï–† -t /CURTAINS/#
```

---

## üîÆ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ë—É–¥—É—â–∏–º –£–ª—É—á—à–µ–Ω–∏—è–º

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ
1. **OTA –û–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –ø–æ –≤–æ–∑–¥—É—Ö—É
2. **Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Home Assistant** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MQTT Discovery
4. **–†–µ–∂–∏–º –ö–∞–ª–∏–±—Ä–æ–≤–∫–∏** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ
1. **–ü—Ä–æ—Ñ–∏–ª–∏ –°–∫–æ—Ä–æ—Å—Ç–∏** - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å/—É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π —à—Ç–æ—Ä—ã
2. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
3. **–°—Ü–µ–Ω—ã** - –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –ø–æ–∑–∏—Ü–∏–π
4. **–†—É—á–Ω–æ–µ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ
1. **–î–∞—Ç—á–∏–∫–∏ –û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç–∏** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–ª–Ω–µ—á–Ω–æ–≥–æ —Å–≤–µ—Ç–∞
2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ù–µ—Å–∫–æ–ª—å–∫–∏—Ö –ö–æ–º–Ω–∞—Ç** - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–Ω–∞—Ç
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏
4. **–ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–µ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–≤–∏–≥–∞—Ç–µ–ª—è

---

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ –†–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–ü—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. –¢—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å –æ–±–æ–∏–º–∏ –¥–≤–∏–≥–∞—Ç–µ–ª—è–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–≤—ã—Ö –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–µ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MQTT
4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
5. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–¢–∞ –∂–µ, —á—Ç–æ –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç.

## ‚ú® –ê–≤—Ç–æ—Ä—ã

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ AI Assistant - 2025
–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: https://geektimes.com/post/298515/
